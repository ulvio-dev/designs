<!DOCTYPE html>
<html lang="nl" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Freya Products - Your Digital Occupational Therapist</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Iconify -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/iconify/2.0.0/iconify.min.js"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Custom Styles -->
  <link rel="stylesheet" href="styles.css">

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="h-full">
  <div id="root" class="h-full"></div>

  <!-- Load Translations -->
  <script type="text/babel" src="translations.js"></script>

  <!-- Load Components -->
  <script type="text/babel" src="components/Navbar.js"></script>
  <script type="text/babel" src="components/Footer.js"></script>
  <script type="text/babel" src="components/SettingsButton.js"></script>
  <script type="text/babel" src="components/SettingsModal.js"></script>

  <!-- Load Pages -->
  <script type="text/babel" src="pages/PatientLanding.js"></script>
  <script type="text/babel" src="pages/ProLanding.js"></script>
  <script type="text/babel" src="pages/ProChatStart.js"></script>
  <script type="text/babel" src="pages/ProChat.js"></script>
  <script type="text/babel" src="pages/ProReport.js"></script>

  <!-- Existing Chat Components (reused for patient flow) -->
  <script type="text/babel" src="PatientChatStart.js"></script>
  <script type="text/babel" src="PatientChat.js"></script>

  <!-- Main App with Router, i18n, and Settings -->
  <script type="text/babel">
    const { useState, useEffect, createContext, useContext } = React;

    // Language Context
    const LanguageContext = createContext();

    const useTranslation = () => {
      const { language } = useContext(LanguageContext);

      const t = (key) => {
        return translations[language]?.[key] || key;
      };

      return { t, language };
    };

    const App = () => {
      const [currentRoute, setCurrentRoute] = useState('patient');
      const [language, setLanguage] = useState('nl');
      const [isLoggedIn, setIsLoggedIn] = useState(true);
      const [settingsOpen, setSettingsOpen] = useState(false);

      // Load saved language and logged in state from localStorage
      useEffect(() => {
        const savedLanguage = localStorage.getItem('freya_language');
        if (savedLanguage && (savedLanguage === 'nl' || savedLanguage === 'en')) {
          setLanguage(savedLanguage);
        }
        const savedLoggedIn = localStorage.getItem('freya_logged_in');
        if (savedLoggedIn !== null) {
          setIsLoggedIn(savedLoggedIn === 'true');
        }
      }, []);

      // Simple hash-based routing
      useEffect(() => {
        const handleHashChange = () => {
          const hash = window.location.hash.slice(1) || 'patient';
          setCurrentRoute(hash);
        };

        handleHashChange();
        window.addEventListener('hashchange', handleHashChange);

        return () => window.removeEventListener('hashchange', handleHashChange);
      }, []);

      // Global navigation function
      window.navigateTo = (route) => {
        window.location.hash = route;
      };

      const handleLanguageChange = (newLanguage) => {
        setLanguage(newLanguage);
        localStorage.setItem('freya_language', newLanguage);
      };

      const handleLoggedInChange = (newLoggedIn) => {
        setIsLoggedIn(newLoggedIn);
        localStorage.setItem('freya_logged_in', newLoggedIn);
      };

      const t = (key) => {
        return translations[language]?.[key] || key;
      };

      // Render the appropriate component based on route
      const renderComponent = () => {
        // Patient Flow
        if (currentRoute === 'patient') return <PatientLanding t={t} />;
        if (currentRoute === 'patient-chat-start') return <PatientChatStart t={t} />;
        if (currentRoute === 'patient-chat') return <PatientChat t={t} />;

        // Professional Flow (with logged in context)
        if (currentRoute === 'pro') return <ProLanding t={t} />;
        if (currentRoute === 'pro-login') return <ProLogin t={t} />;
        if (currentRoute === 'pro-chat-start') return <ProChatStart t={t} isLoggedIn={isLoggedIn} />;
        if (currentRoute === 'pro-chat') return <ProChat t={t} isLoggedIn={isLoggedIn} />;
        if (currentRoute === 'pro-report') return <ProReport t={t} isLoggedIn={isLoggedIn} />;

        // Default
        return <PatientLanding t={t} />;
      };

      // Placeholder login component (simplified)
      const ProLogin = ({ t }) => (
        <div className="h-full flex items-center justify-center bg-gray-50">
          <div className="text-center p-8 bg-white rounded-xl shadow-lg max-w-md">
            <h2 className="text-2xl font-bold mb-4">{t('login_title')}</h2>
            <p className="text-gray-600 mb-6">Professional login page (simplified for demo)</p>
            <button
              onClick={() => window.navigateTo('pro-chat-start')}
              className="px-6 py-3 bg-[#90A40A] text-white rounded-lg hover:bg-[#7a8d08] transition-all"
            >
              {t('login_demo')}
            </button>
          </div>
        </div>
      );

      return (
        <LanguageContext.Provider value={{ language, setLanguage: handleLanguageChange }}>
          <div className="h-full relative">
            {renderComponent()}
            <SettingsButton onClick={() => setSettingsOpen(true)} />
            <SettingsModal
              isOpen={settingsOpen}
              onClose={() => setSettingsOpen(false)}
              currentLanguage={language}
              onLanguageChange={handleLanguageChange}
              isLoggedIn={isLoggedIn}
              onLoggedInChange={handleLoggedInChange}
              t={t}
            />
          </div>
        </LanguageContext.Provider>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
